<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>理解unix进程python</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">liuzhe</a></h1>
            <a class='extra' href="/">blog</a>
            <a class="extra" href="/note.html">note</a>
          </div>

          <h2>理解unix进程python</h2>
<p class="meta">25 Jun 2013</p>

<div class="post">
<h2>进程皆有标识</h2>

<div class="highlight"><pre><code class="python"><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
</code></pre></div>

<h2>进程皆有父</h2>

<div class="highlight"><pre><code class="python"><span class="n">os</span><span class="o">.</span><span class="n">getppid</span><span class="p">()</span>
</code></pre></div>

<h2>进程皆有文件描述符</h2>

<div class="highlight"><pre><code class="python"><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">file</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</code></pre></div>

<p>在unix系统中万物皆文件，在进程中打开一个文件（设备，管道，套接字等）会获得一个该进程中唯一的文件标识符，文件描述符不会在无关进程之间共享。在进程中打开的文件，其文件描述符会从3开始，进程会分配一个最小的未使用的非负整数。号码从3开始说明 0 1 2 已经被占用，其实每个unix进程都有三个打开的资源，分别是 标准输入 标准输出和标准错误</p>

<div class="highlight"><pre><code class="python"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
<span class="o">=&gt;</span> <span class="mi">0</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
<span class="o">=&gt;</span> <span class="mi">1</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
    
</code></pre></div>

<h2>进程皆有资源限制</h2>

<div class="highlight"><pre><code class="python"><span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_NOFILE</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>  <span class="c">#这是我机器的返回</span>
</code></pre></div>

<p>返回为一个元组，第一个返回值为软限制，第二个返回值为硬限制。软限制其实不算限制，超过软限制程序会抛出异常，进程可以修改软限制，但硬限制只有在进程有足够的权限时才能修改。我们来试着修改一下限制,修改为的两个参数尽量不要超过原来硬限制的值（当前硬限制的值), 也就是说如果修改后已修改后的为准：</p>

<div class="highlight"><pre><code class="python"><span class="n">resource</span><span class="o">.</span><span class="n">setrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_NOFILE</span><span class="p">,(</span><span class="mi">4000</span><span class="p">,</span><span class="mi">4096</span><span class="p">))</span>
<span class="n">resource</span><span class="o">.</span><span class="n">getrlimit</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">RLIMIT_NOFILE</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">(</span><span class="mi">4000</span><span class="p">,</span><span class="mi">4096</span><span class="p">)</span>
    
</code></pre></div>

<p>其它相关使用资源的查询与修改类似，比如现在进程所能衍生的进程的限制，参照 http://docs.python.org/2/library/resource.html</p>

<h2>进程皆有环境</h2>

<p>环境指的是环境变量，python读取环境变量：</p>

<div class="highlight"><pre><code class="python"><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;PATH&#39;</span><span class="p">)</span>
<span class="o">=&gt;</span>
<span class="s">&#39;/home/vagrant/.rvm/gems/ruby-2.0.0-p247/bin:/home/vagrant/.rvm/gems/ruby-2.0.0-p247@global</span>
<span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">p247</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span>
<span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">games</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">vagrant_ruby</span><span class="o">/</span><span class="nb">bin</span><span class="s">&#39;</span>
</code></pre></div>

<h2>进程皆有参数</h2>

<p>进程可以访问 sys.argv 的数组来获得命令行传进来的参数</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>
<p>编写命令行程序的话可以用optparse 
http://docs.python.org/2/library/optparse.html</p>

<p>未完。。。</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'liuzhe0223'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
               liuzhe 
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/liuzhe0223">github.com/liuzhe0223</a><br />
                <a href="https://twitter.com/liuzhe0223">twitter.com/liuzhe0223</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
