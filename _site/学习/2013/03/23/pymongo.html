<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>pymongo(2)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">liuzhe</a></h1>
          </div>

          <h2>pymongo(2)</h2>
<p class="meta">23 Mar 2013</p>

<div class="post">
<p>sort() 方法使用:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)</span>  <span class="c">#age的正序排列</span>
<span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span><span class="p">)</span>  <span class="c">#age的逆序排列</span>
</code></pre></div>
<p>或者使用：</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">&quot;age&quot;</span><span class="p">:{</span><span class="s">&quot;$gt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASENDING</span><span class="p">)])</span>
</code></pre></div>
<p>使用limit()做限定:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p>实现offset:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">slcip</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p>update()的使用:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;liuzhe&quot;</span><span class="p">},</span>
                 <span class="p">{</span><span class="s">&quot;$set&quot;</span><span class="p">;{</span><span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">}},</span>
                 <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>
<p>注意使用上述方式时，如果条件匹配到多于一条的记录时，只会对搜索到的第一条记录进行修改，使用时需注意匹配条件的唯一，当要修改符合条件的多条记录时可以加上一个参数如下:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;liuzhe&quot;</span><span class="p">},</span>
                 <span class="p">{</span><span class="s">&quot;$set&quot;</span><span class="p">;{</span><span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">}},</span>
                 <span class="n">multi</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>
<p>删除记录:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;liuzhe&quot;</span><span class="p">})</span>
</code></pre></div>
<p>使用上述方法删除记录时，如果没有符合条件的记录不会引发异常，某个collection 中所有的记录时只需把条件设为None即可，如下:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>
<p>对嵌入的字典进行定位时(use a dot):</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s">&quot;schools.university&quot;</span><span class="p">:</span> <span class="s">&quot;sdut&quot;</span><span class="p">)</span>
</code></pre></div>
<p>使用mongodb时我们可能会在一个document中添加很多数据， 而mongodb对单个doucument的限制大小为最大16MB，已经很大啦</p>

<p>建立索引:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">dbh</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="text language-text" data-lang="text">dbh.users.create_index(&quot;username&quot;, pymongo.ASCENDING)
</code></pre></div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'liuzhe0223'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
               liuzhe 
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/liuzhe0223">github.com/liuzhe0223</a><br />
                <a href="https://twitter.com/liuzhe0223">twitter.com/liuzhe0223</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
